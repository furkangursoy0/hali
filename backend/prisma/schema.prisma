generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  STAFF
}

enum RenderStatus {
  processing
  success
  failed
}

model User {
  id           String      @id @default(cuid())
  fullName     String
  email        String      @unique
  passwordHash String
  role         UserRole    @default(STAFF)
  credit       Int         @default(0)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  renders      RenderJob[]
  creditLogs   CreditLog[]
}

model RenderJob {
  id        String       @id @default(cuid())
  userId    String?
  mode      String
  status    RenderStatus @default(processing)
  error     String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  user      User?        @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([createdAt])
}

model CreditLog {
  id        String   @id @default(cuid())
  userId    String
  delta     Int
  reason    String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}
